version: "3.9"

services:
  sonarqube:
    image: sonarqube:lts-community
    container_name: sonar-container
    restart: always
    networks:
      - sonarnet
    environment:
      - SONARQUBE_JDBC_USERNAME=sonar
      - SONARQUBE_JDBC_PASSWORD=sonar
      - SONARQUBE_JDBC_URL=jdbc:postgresql://postgressdb:5432/sonarqube
    ports:
      - "9000:9000"
      - "9092:9092"
  #       volumes:
  #       - './data/sonar/sonarqube_conf:/opt/sonarqube/conf'
  #       - './data/sonar/sonarqube_data:/opt/sonarqube/data'
  #       - './data/sonar/sonarqube_extensions:/opt/sonarqube/extensions'
  #       - './data/sonar/sonarqube_bundled-plugins:/opt/sonarqube/lib/bundled-plugins'

  postgressdb:
    image: postgres:16.3-alpine3.20
    container_name: postgres-container
    restart: always
    networks:
      - sonarnet
    environment:
      - POSTGRES_USER=sonar
      - POSTGRES_PASSWORD=sonar
      - POSTGRES_DB=sonarqube
#    volumes:
#      - './data/postgresql/sonarqube_db:/var/lib/postgresql'
#      - './data/postgresql/postgresql_data:/var/lib/postgresql/data'
  octopus-server:
      image: octopusdeploy/octopusdeploy:${OCTOPUS_SERVER_TAG}
      privileged: ${PRIVILEGED}
      user: ${CONTAINER_USER}
      environment:
        ACCEPT_EULA: ${ACCEPT_OCTOPUS_EULA}
        OCTOPUS_SERVER_NODE_NAME: ${OCTOPUS_SERVER_NODE_NAME}
        DB_CONNECTION_STRING: ${DB_CONNECTION_STRING}
        ADMIN_USERNAME: ${ADMIN_USERNAME}
        ADMIN_PASSWORD: ${ADMIN_PASSWORD}
        ADMIN_EMAIL: ${ADMIN_EMAIL}
        OCTOPUS_SERVER_BASE64_LICENSE: ${OCTOPUS_SERVER_BASE64_LICENSE}
        MASTER_KEY: ${MASTER_KEY}
        ADMIN_API_KEY: ${ADMIN_API_KEY}
        DISABLE_DIND: ${DISABLE_DIND}
        TASK_CAP: ${TASK_CAP}
      ports:
        - 8080:8080
        - 11111:10943
      depends_on:
        - db
  #     volumes:
  #       - repository:/repository
  #       - artifacts:/artifacts
  #       - taskLogs:/taskLogs
  #       - cache:/cache
  #       - import:/import
  #       - eventExports:/eventExports
  # volumes:
  #   repository:
  #   artifacts:
  #   taskLogs:
  #   cache:
  #   import:
  #   eventExports:
  #   sqlvolume:



networks:
  sonarnet:
    driver: bridge